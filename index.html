<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Desafio de Inglês</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; text-align: center; padding: 30px; }
    #app { max-width: 600px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    input, button { padding: 10px; margin: 5px; font-size: 16px; }
    #ranking { text-align: left; margin-top: 20px; }
    .hidden { display: none; }
    .word { font-size: 24px; margin: 20px 0; font-weight: bold; }
  </style>
</head>
<body>
  <div id="app">
    <div id="nicknameSection">
      <h2>Digite seu nickname:</h2>
      <input type="text" id="nicknameInput" placeholder="Seu nome ou apelido" />
      <button onclick="startGame()">Começar</button>
    </div>

    <div id="gameSection" class="hidden">
      <h2>Bem-vindo, <span id="playerName"></span>!</h2>
      <div class="word" id="englishWord"></div>
      <input type="text" id="translationInput" placeholder="Digite a tradução" />
      <button onclick="checkTranslation()">Enviar</button>
      <button onclick="giveUp()">Desistir</button>
      <p>Pontos: <span id="score">0</span></p>
    </div>

    <div id="rankingSection">
      <h3>Ranking Top 10</h3>
      <ol id="ranking"></ol>
    </div>
  </div>

  <script>
    // Palavras por nível
    const words = {
      basic: [
        {en: 'cat', pt: 'gato'}, {en: 'dog', pt: 'cachorro'}, {en: 'house', pt: 'casa'},
        {en: 'sun', pt: 'sol'}, {en: 'book', pt: 'livro'}, {en: 'car', pt: 'carro'},
        {en: 'milk', pt: 'leite'}, {en: 'water', pt: 'água'}, {en: 'bread', pt: 'pão'},
        {en: 'apple', pt: 'maçã'}, {en: 'banana', pt: 'banana'}, {en: 'school', pt: 'escola'},
        {en: 'pen', pt: 'caneta'}, {en: 'chair', pt: 'cadeira'}, {en: 'table', pt: 'mesa'},
        {en: 'window', pt: 'janela'}, {en: 'door', pt: 'porta'}, {en: 'tree', pt: 'árvore'},
        {en: 'flower', pt: 'flor'}, {en: 'phone', pt: 'telefone'}
      ],
      intermediate: [
        {en: 'kitchen', pt: 'cozinha'}, {en: 'mirror', pt: 'espelho'}, {en: 'garden', pt: 'jardim'},
        {en: 'bottle', pt: 'garrafa'}, {en: 'teacher', pt: 'professor'}, {en: 'student', pt: 'aluno'},
        {en: 'market', pt: 'mercado'}, {en: 'clothes', pt: 'roupas'}, {en: 'computer', pt: 'computador'},
        {en: 'keyboard', pt: 'teclado'}, {en: 'mouse', pt: 'mouse'}, {en: 'pencil', pt: 'lápis'},
        {en: 'notebook', pt: 'caderno'}, {en: 'television', pt: 'televisão'}, {en: 'refrigerator', pt: 'geladeira'},
        {en: 'street', pt: 'rua'}, {en: 'traffic', pt: 'trânsito'}, {en: 'weather', pt: 'clima'},
        {en: 'holiday', pt: 'feriado'}, {en: 'birthday', pt: 'aniversário'}, {en: 'medicine', pt: 'remédio'},
        {en: 'hospital', pt: 'hospital'}, {en: 'airplane', pt: 'avião'}, {en: 'airport', pt: 'aeroporto'},
        {en: 'bicycle', pt: 'bicicleta'}, {en: 'mountain', pt: 'montanha'}, {en: 'river', pt: 'rio'},
        {en: 'forest', pt: 'floresta'}, {en: 'countryside', pt: 'campo'}, {en: 'city', pt: 'cidade'}
      ],
      advanced: [
        {en: 'achievement', pt: 'realização'}, {en: 'development', pt: 'desenvolvimento'}, {en: 'relationship', pt: 'relacionamento'},
        {en: 'government', pt: 'governo'}, {en: 'environment', pt: 'meio ambiente'}, {en: 'responsibility', pt: 'responsabilidade'},
        {en: 'opportunity', pt: 'oportunidade'}, {en: 'investment', pt: 'investimento'}, {en: 'leadership', pt: 'liderança'},
        {en: 'partnership', pt: 'parceria'}, {en: 'knowledge', pt: 'conhecimento'}, {en: 'management', pt: 'gestão'},
        {en: 'entrepreneur', pt: 'empreendedor'}, {en: 'strategy', pt: 'estratégia'}, {en: 'sustainability', pt: 'sustentabilidade'},
        {en: 'technology', pt: 'tecnologia'}, {en: 'innovation', pt: 'inovação'}, {en: 'negotiation', pt: 'negociação'},
        {en: 'performance', pt: 'desempenho'}, {en: 'efficiency', pt: 'eficiência'}, {en: 'productivity', pt: 'produtividade'},
        {en: 'organization', pt: 'organização'}, {en: 'communication', pt: 'comunicação'}, {en: 'motivation', pt: 'motivação'},
        {en: 'achievement', pt: 'conquista'}, {en: 'perception', pt: 'percepção'}, {en: 'contribution', pt: 'contribuição'},
        {en: 'collaboration', pt: 'colaboração'}, {en: 'situation', pt: 'situação'}, {en: 'evaluation', pt: 'avaliação'},
        {en: 'qualification', pt: 'qualificação'}, {en: 'application', pt: 'aplicação'}, {en: 'registration', pt: 'registro'},
        {en: 'participation', pt: 'participação'}, {en: 'interview', pt: 'entrevista'}, {en: 'requirement', pt: 'requisito'},
        {en: 'department', pt: 'departamento'}, {en: 'experience', pt: 'experiência'}, {en: 'discipline', pt: 'disciplina'},
        {en: 'laboratory', pt: 'laboratório'}, {en: 'experiment', pt: 'experimento'}
      ]
    };

    let db;
    let nickname = '';
    let score = 0;
    let usedWords = [];
    let currentWord;
    let currentLevel = 'basic';

    function initDB() {
      const request = indexedDB.open('EnglishGameDB', 1);
      request.onupgradeneeded = (e) => {
        db = e.target.result;
        db.createObjectStore('users', { keyPath: 'nickname' });
        db.createObjectStore('ranking', { keyPath: 'nickname' });
      };
      request.onsuccess = (e) => {
        db = e.target.result;
        checkSavedNickname();
        loadRanking();
      };
    }

    function checkSavedNickname() {
      const tx = db.transaction('users', 'readonly');
      const store = tx.objectStore('users');
      const getReq = store.getAll();
      getReq.onsuccess = () => {
        if (getReq.result.length > 0) {
          nickname = getReq.result[0].nickname;
          document.getElementById('playerName').textContent = nickname;
          document.getElementById('nicknameSection').classList.add('hidden');
          document.getElementById('gameSection').classList.remove('hidden');
          nextWord();
        }
      };
    }

    function startGame() {
      const input = document.getElementById('nicknameInput');
      nickname = input.value.trim();
      if (!nickname) return alert('Digite um nome válido!');
      const tx = db.transaction('users', 'readwrite');
      const store = tx.objectStore('users');
      store.put({ nickname });
      document.getElementById('playerName').textContent = nickname;
      document.getElementById('nicknameSection').classList.add('hidden');
      document.getElementById('gameSection').classList.remove('hidden');
      nextWord();
    }

    function getCurrentLevel() {
      if (score < 20) return 'basic';
      if (score < 50) return 'intermediate';
      return 'advanced';
    }

    function nextWord() {
      currentLevel = getCurrentLevel();
      let levelWords = words[currentLevel].filter(w => !usedWords.includes(w.en));
      if (levelWords.length === 0) return alert('Você completou todas as palavras!');
      currentWord = levelWords[Math.floor(Math.random() * levelWords.length)];
      usedWords.push(currentWord.en);
      document.getElementById('englishWord').textContent = currentWord.en;
      document.getElementById('translationInput').value = '';
    }

    function checkTranslation() {
      const input = document.getElementById('translationInput').value.trim().toLowerCase();
      if (input === currentWord.pt.toLowerCase()) {
        score++;
        document.getElementById('score').textContent = score;
        nextWord();
      } else {
        saveToRanking();
        alert(`Errou! A tradução correta era: ${currentWord.pt}. Você fez ${score} pontos.`);
        location.reload();
      }
    }

    function giveUp() {
      saveToRanking();
      alert(`Você desistiu com ${score} pontos.`);
      location.reload();
    }

    function saveToRanking() {
      const tx = db.transaction('ranking', 'readwrite');
      const store = tx.objectStore('ranking');
      store.getAll().onsuccess = function(e) {
        let data = e.target.result;
        data.push({ nickname, score });
        data.sort((a, b) => b.score - a.score);
        data = data.slice(0, 10);
        const clearTx = db.transaction('ranking', 'readwrite');
        const clearStore = clearTx.objectStore('ranking');
        clearStore.clear().onsuccess = () => {
          data.forEach(entry => clearStore.put(entry));
        };
      };
    }

    function loadRanking() {
      const tx = db.transaction('ranking', 'readonly');
      const store = tx.objectStore('ranking');
      const req = store.getAll();
      req.onsuccess = () => {
        const list = document.getElementById('ranking');
        req.result.sort((a, b) => b.score - a.score);
        list.innerHTML = '';
        req.result.forEach(entry => {
          const li = document.createElement('li');
          li.textContent = `${entry.nickname} - ${entry.score} pontos`;
          list.appendChild(li);
        });
      };
    }

    initDB();
  </script>
</body>
</html>